generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  name               String
  email              String              @unique
  password           String
  role               Role
  isApproved         Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  commissions        ManagerCommission[]
  properties         Property[]
  todos              ToDo[]
  createdOffers      OfferLetter[]
  dailyReports       DailyReport[]
  activationRequests ActivationRequest[]
}

model Landlord {
  id           String        @id @default(uuid())
  name         String
  email        String?
  phone        String?
  address      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  idNumber     String?
  offerLetters OfferLetter[]
  properties   Property[]
}

model Property {
  id                 String              @id @default(uuid())
  name               String
  address            String
  lrNumber           String?
  landlordId         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  managerId          String?
  form               PropertyForm
  usage              UsageType
  commissionFee      Float?
  image              String?
  accountName        String?
  accountNo          String?
  bank               String?
  branch             String?
  branchCode         String?
  incomes            Income[]
  leads              Lead[]
  commissions        ManagerCommission[]
  offerLetters       OfferLetter[]
  landlord           Landlord?           @relation(fields: [landlordId], references: [id])
  manager            User?               @relation(fields: [managerId], references: [id])
  serviceProviders   ServiceProvider[]
  units              Unit[]
  dailyReports       DailyReport[]
  activationRequests ActivationRequest[]
}

model ManagerCommission {
  id               String           @id @default(uuid())
  propertyId       String
  managerId        String
  commissionFee    Float
  incomeAmount     Float
  commissionAmount Float
  periodStart      DateTime
  periodEnd        DateTime
  status           CommissionStatus @default(PENDING)
  paidDate         DateTime?
  notes            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  manager          User             @relation(fields: [managerId], references: [id])
  property         Property         @relation(fields: [propertyId], references: [id])

  @@unique([managerId, propertyId, periodStart, periodEnd])
  @@index([managerId, periodStart, periodEnd])
  @@index([propertyId, periodStart, periodEnd])
}

model Unit {
  id           String        @id @default(uuid())
  propertyId   String
  bedrooms     Int?
  bathrooms    Int?
  sizeSqFt     Int
  type         String?
  status       UnitStatus    @default(VACANT)
  rentType     RentType
  rentAmount   Float
  floor        String?
  unitNo       String?
  unitType     UnitType
  usage        String?
  offerLetters OfferLetter[]
  tenant       Tenant?
  property     Property      @relation(fields: [propertyId], references: [id])
}

model Tenant {
  id                  String               @id @default(uuid())
  unitId              String               @unique
  leaseTerm           String
  rent                Float
  termStart           DateTime
  rentStart           DateTime
  deposit             Float
  contact             String
  fullName            String
  KRAPin              String               @unique
  POBox               String?
  email               String?              @unique
  paymentPolicy       PaymentPolicy
  escalationFrequency EscalationFrequency?
  escalationRate      Float?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  vatRate             Float?               @default(0)
  vatType             VATType              @default(NOT_APPLICABLE)
  bills               Bill[]
  billInvoices        BillInvoice[]
  incomes             Income[]
  invoices            Invoice[]
  paymentReports      PaymentReport[]
  serviceCharge       ServiceCharge?
  unit                Unit                 @relation(fields: [unitId], references: [id])
}

model ServiceCharge {
  id          String            @id @default(uuid())
  tenantId    String            @unique
  type        ServiceChargeType
  fixedAmount Float?
  percentage  Float?
  perSqFtRate Float?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  tenant      Tenant            @relation(fields: [tenantId], references: [id])
}

model PaymentReport {
  id            String        @id @default(uuid())
  tenantId      String
  datePaid      DateTime      @default(now())
  notes         String?
  amountPaid    Float
  arrears       Float
  createdAt     DateTime      @default(now())
  paymentPeriod DateTime
  rent          Float
  serviceCharge Float?
  status        PaymentStatus @default(UNPAID)
  totalDue      Float
  updatedAt     DateTime      @updatedAt
  vat           Float?
  billInvoices  BillInvoice[]
  invoices      Invoice[]
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Income {
  id         String          @id @default(uuid())
  propertyId String?
  tenantId   String?
  amount     Float
  frequency  IncomeFrequency
  createdAt  DateTime        @default(now())
  property   Property?       @relation(fields: [propertyId], references: [id])
  tenant     Tenant?         @relation(fields: [tenantId], references: [id])
}

model Invoice {
  id              String         @id @default(cuid())
  invoiceNumber   String         @unique
  tenantId        String
  paymentReportId String?
  issueDate       DateTime       @default(now())
  dueDate         DateTime
  paymentPeriod   String
  rent            Float
  serviceCharge   Float?         @default(0)
  vat             Float?         @default(0)
  totalDue        Float
  amountPaid      Float          @default(0)
  balance         Float
  status          InvoiceStatus  @default(UNPAID)
  pdfUrl          String?
  notes           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  paymentReport   PaymentReport? @relation(fields: [paymentReportId], references: [id])
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([invoiceNumber])
  @@index([status])
}

model BillInvoice {
  id                  String         @id @default(uuid())
  invoiceNumber       String         @unique
  billId              String
  billReferenceNumber String
  billReferenceDate   DateTime
  tenantId            String
  issueDate           DateTime       @default(now())
  dueDate             DateTime
  billType            BillType
  previousReading     Float
  currentReading      Float
  units               Float
  chargePerUnit       Float
  totalAmount         Float
  vatRate             Float?
  vatAmount           Float?
  grandTotal          Float
  amountPaid          Float          @default(0)
  balance             Float
  status              InvoiceStatus  @default(UNPAID)
  pdfUrl              String?
  notes               String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  paymentReportId     String?
  bill                Bill           @relation(fields: [billId], references: [id], onDelete: Cascade)
  paymentReport       PaymentReport? @relation(fields: [paymentReportId], references: [id])
  tenant              Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([billId])
  @@index([tenantId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([billReferenceNumber])
}

model ServiceProvider {
  id              String          @id @default(uuid())
  propertyId      String
  name            String
  contact         String?
  contractPeriod  String?
  serviceContract String?
  chargeAmount    Float
  chargeFrequency ChargeFrequency @default(MONTHLY)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  property        Property        @relation(fields: [propertyId], references: [id])
}

model Bill {
  id              String        @id @default(uuid())
  tenantId        String
  type            BillType
  description     String?
  previousReading Float
  currentReading  Float
  units           Float         @default(0)
  chargePerUnit   Float
  totalAmount     Float
  vatRate         Float?
  vatAmount       Float?
  grandTotal      Float
  status          BillStatus    @default(UNPAID)
  issuedAt        DateTime      @default(now())
  dueDate         DateTime?
  paidAt          DateTime?
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  amountPaid      Float         @default(0)
  tenant          Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  billInvoices    BillInvoice[]

  @@index([tenantId])
  @@index([type, status])
  @@index([issuedAt])
}

model Lead {
  id           String        @id @default(uuid())
  name         String
  phone        String
  address      String?
  natureOfLead String?
  notes        String?
  propertyId   String?
  createdAt    DateTime      @default(now())
  email        String?
  updatedAt    DateTime      @updatedAt
  companyName  String?
  idNumber     String?
  property     Property?     @relation(fields: [propertyId], references: [id])
  offerLetters OfferLetter[]
}

model OfferLetter {
  id              String      @id @default(uuid())
  offerNumber     String      @unique
  leadId          String
  propertyId      String
  unitId          String?
  landlordId      String
  usageType       UsageType
  issueDate       DateTime    @default(now())
  expiryDate      DateTime?
  rentAmount      Float
  deposit         Float
  leaseTerm       String
  serviceCharge   Float?
  escalationRate  Float?
  documentUrl     String?
  additionalTerms String?
  notes           String?
  createdById     String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  leaseStartDate  DateTime?
  metadata        Json?
  rentStartDate   DateTime?
  letterType      LetterType
  status          OfferStatus @default(DRAFT)
  landlord        Landlord    @relation(fields: [landlordId], references: [id])
  lead            Lead        @relation(fields: [leadId], references: [id])
  property        Property    @relation(fields: [propertyId], references: [id])
  unit            Unit?       @relation(fields: [unitId], references: [id])
  createdBy       User?       @relation(fields: [createdById], references: [id])
}

// Add these to your existing schema.prisma file

model DailyReport {
  id            String   @id @default(uuid())
  propertyId    String
  managerId     String
  reportDate    DateTime
  day           String
  timeSubmitted DateTime
  preparedBy    String

  // Security Report
  securityProvider          String?
  shiftCoverage             String?
  securityIncidents         String?
  securityActions           String?
  securityOutstandingIssues String?

  // Cleaning & Sanitation
  cleaningContractor       String?
  areasCleaned             Json? // Store as JSON array
  cleanlinessStandard      String?
  cleaningIssues           String?
  cleaningCorrectiveAction String?

  // Maintenance & Repairs
  preventiveTasks Json? // Store as JSON array of tasks
  repairs         Json? // Store as JSON array of repairs

  // Tenant Complaints
  tenantComplaints Json? // Store as JSON array

  // Landlord Instructions
  landlordInstructions String?
  landlordActionTaken  String?
  landlordStatus       String?

  // Leads & Enquiries
  newEnquiries   Int?    @default(0)
  enquirySource  String?
  unitsEnquired  String?
  followUpAction String?
  siteVisits     Int?    @default(0)

  // Bookings & Occupancy
  bookingsReceived  String?
  bookingsConfirmed Int?    @default(0)
  bookingsCancelled Int?    @default(0)
  occupancyLevel    Float?  @default(0)
  bookingsRemarks   String?

  // Activations/Events
  activationName   String?
  activityNature   String?
  activityDateTime DateTime?
  activityImpact   String?

  // Utilities Status
  waterStatus         String? @default("NORMAL")
  electricityStatus   String? @default("NORMAL")
  otherServicesStatus String? @default("NORMAL")
  utilitiesRemarks    String?

  // General Observations
  operationalChallenges String?
  healthSafetyIssues    String?

  // Attachments
  attachments Json? // Store as JSON array of attachments

  // Status
  status ReportStatus @default(DRAFT)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id])
  manager  User     @relation(fields: [managerId], references: [id])

  @@index([propertyId])
  @@index([managerId])
  @@index([reportDate])
  @@index([status])
}

enum ReportStatus {
  DRAFT
  SUBMITTED
  REVIEWED
  ARCHIVED
}

model ActivationRequest {
  id            String @id @default(uuid())
  requestNumber String @unique
  propertyId    String
  managerId     String

  // Part 1 - Client Information (Required for template)
  companyName   String
  postalAddress String
  telephone     String
  contactPerson String
  alternativeContact String?
  designation   String
  email         String
  mobileNo      String

  // Part 2 - Description of Activation/Exhibition (Required for template)
  startDate        DateTime
  setupTime        String
  endDate          DateTime
  tearDownTime     String
  activationType   String
  description      String?
  expectedVisitors Int?
  soundSystem      Boolean @default(false)

  // Part 3 - Cost of Activation/Exhibition (Required for template)
  licenseFeePerDay Float?
  numberOfDays     Int?
  proposedBudget   Float? // Fallback for licenseFeePerDay

  // Payment Details (Required for template)
  bankName      String?
  bankBranch    String?
  accountName   String?
  accountNumber String?
  swiftCode     String?
  paybillNumber String?
  mpesaAccount  String?

  // Manager Information (Required for template)
  managerName        String? // Manager's name for signature
  managerDesignation String? // Manager's designation

  // Document Management
  documentUrl   String? // Generated PDF URL
  status        ActivationStatus @default(DRAFT)
  

  // Timestamps (Used in template)
  submittedAt DateTime?
  approvedAt  DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Signature Information
  signatureDate DateTime?

  // Relations
  property Property @relation(fields: [propertyId], references: [id])
  manager  User     @relation(fields: [managerId], references: [id])

  @@index([propertyId])
  @@index([managerId])
  @@index([status])
  @@index([startDate])
}

enum ActivationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

model ToDo {
  id          String     @id @default(uuid())
  userId      String
  title       String
  description String?
  status      ToDoStatus @default(PENDING)
  dueDate     DateTime?
  createdAt   DateTime   @default(now())
  user        User       @relation(fields: [userId], references: [id])
}

model News {
  id          String   @id @default(uuid())
  title       String
  content     String
  publishedAt DateTime @default(now())
}

enum Role {
  ADMIN
  MANAGER
}

enum PropertyForm {
  APARTMENT
  BUNGALOW
  VILLA
  OFFICE
  SHOP
  DUPLEX
  TOWNHOUSE
  MAISONETTE
  WAREHOUSE
  INDUSTRIAL_BUILDING
  RETAIL_CENTER
}

enum UsageType {
  RESIDENTIAL
  COMMERCIAL
  INDUSTRIAL
  INSTITUTIONAL
  MIXED_USE
}

enum CommissionStatus {
  PENDING
  PAID
  PROCESSING
  CANCELLED
}

enum UnitType {
  RESIDENTIAL
  COMMERCIAL
}

enum UnitStatus {
  VACANT
  OCCUPIED
}

enum RentType {
  PER_SQFT
  FIXED
  TIERED
  GRADUATED
  INDEXED
  PERCENT_OF_REVENUE
  PER_ROOM
  PER_OCCUPANT
  PER_BED
  DAILY
  WEEKLY
  MONTHLY
  ANNUAL
  NEGOTIATED
  PARTIAL_SUBSIDY
  VARIABLE
}

enum VATType {
  INCLUSIVE
  EXCLUSIVE
  NOT_APPLICABLE
}

enum EscalationFrequency {
  ANNUALLY
  BI_ANNUALLY
}

enum ServiceChargeType {
  FIXED
  PERCENTAGE
  PER_SQ_FT
}

enum PaymentPolicy {
  MONTHLY
  QUARTERLY
  ANNUAL
}

enum PaymentStatus {
  PAID
  PARTIAL
  UNPAID
}

enum IncomeFrequency {
  MONTHLY
  QUARTERLY
  ANNUAL
}

enum InvoiceStatus {
  UNPAID
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum ChargeFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUAL
}

enum BillType {
  WATER
  ELECTRICITY
}

enum BillStatus {
  UNPAID
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum OfferStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
  CONVERTED
}

enum LetterType {
  COMMERCIAL
  RESIDENTIAL
}

enum ToDoStatus {
  PENDING
  COMPLETED
}
